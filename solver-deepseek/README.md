# Problem Solver (DeepSeek/OpenRouter Version)

このプロジェクトは、論文「Gemini 2.5 Pro Capable of Winning Gold at IMO 2025」で提案された、数学オリンピックの問題を解くための「自己検証パイプライン」を実装したものです。

* **元実装**: https://github.com/lyang36/IMO25/tree/main

元の実装からAPIとデータソースを変更し、DeepSeekモデル（OpenRouter経由）とHugging Faceのデータセットを利用するように改造しています。

* **データ取得元**: https://huggingface.co/datasets/Man-snow/evolved-math-problems-OlympiadBench-from-deepseek-r1-0528-free/
* **利用API**: https://openrouter.ai/deepseek/deepseek-r1:free

## 主な機能

* **自動問題取得**: Hugging Face Hubから問題を自動で取得します。
* **自己検証パイプライン**: 論文で提案された「生成→自己改善→検証→修正」のループを実行し、解の精度を高めます。
* **並列実行**: 1つの問題に対し、複数のエージェントを並列で実行することで、解を発見する確率と速度を向上させます。
* **カスタマイズ性**: モデルやプロンプト、各種パラメータを容易に変更できるよう設計されています。

---

## 事前準備

実行には以下の準備が必要です。

### 1. リポジトリのクローン

まず、プロジェクトファイルをローカル環境に準備します。

```bash
# このリポジトリをクローンする場合
git clone <repository_url>
cd <repository_name>

# または、提供されたファイルを同じフォルダに保存します。
```

### 2. APIキーの設定

プロジェクトのルートディレクトリに `.env` という名前のファイルを作成し、お持ちのOpenRouter APIキーを以下のように記述してください。

**.env**
```
OPENROUTER_API_KEY="sk-or-..."
```

### 3. 必要なライブラリのインストール

ターミナルで以下のコマンドを実行し、プロジェクトに必要なPythonライブラリをインストールします。

```bash
pip install -r requirements.txt
```

---

## スクリプトの実行方法

すべての準備が完了したら、以下のコマンドを実行するだけで、全体のプロセスが開始されます。

```bash
python run_solver.py
```

このコマンドにより、以下の処理が自動で行われます。
1.  Hugging Faceから指定された3つの問題を取得します。
2.  各問題に対し、3つのエージェントを並列実行して解答を試みます。
3.  実行中のログは、`logs`ディレクトリ内のファイルに保存されます。
4.  いずれかのエージェントが解を発見した場合、その問題の処理は終了し、次の問題に進みます。

---

## ファイル構成

| ファイル名             | 説明                                                                                                                              |
| ---------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| **`run_solver.py`** | **実行用メインスクリプト（司令塔）**。問題取得から並列実行の管理まで、プロジェクト全体のワークフローを担当します。                    |
| **`solver_agent.py`** | **エージェントのコアロジック**。論文の自己検証パイプライン（生成・改善・検証・修正ループ）を実装しています。                      |
| `requirements.txt`     | プロジェクトに必要なPythonライブラリのリストです。                                                                                |
| `.env`                 | APIキーなどの環境変数を保存するファイルです。Gitの管理対象外にすることが推奨されます。                                            |
| `logs/`                | （実行時に自動生成）各エージェントの実行ログが保存されるディレクトリです。                                                        |

---

## 注意事項

* **APIコスト**: `deepseek-r1:free`は無料ですが、OpenRouterで他のモデルを利用する場合はコストが発生する可能性があります。利用状況はご自身でご確認ください。
* **実行時間**: パイプラインは複数のAPI呼び出しと反復処理を含むため、1つの問題を解くのに時間がかかります。スクリプト内のタイムアウト設定（デフォルト30分）は環境に応じて調整してください。
* **解答の確実性**: このプログラムは必ずしもすべての問題の正解を保証するものではありません。成功率は、モデルの能力と問題の難易度に依存します。